<app-sidebar-layout>

  <app-search-bar id="app-navbar" class="mat-elevation-z2" [showSearch]="true">

  </app-search-bar>

  <div class="root">

    <div fxLayout="row" fxLayoutAlign="end middle">
      <div>
        <button mat-raised-button color="accent" (click)="openSettings()" *ngIf="admin">
          <mat-icon>settings</mat-icon>
          Manage party
        </button>

        <button mat-raised-button color="warn" (click)="leave()">
          <mat-icon>exit_to_app</mat-icon>
          Leave party
        </button>
      </div>
    </div>

    <div fxLayout="row" fxLayoutWrap="true">

      <div fxFlex.gt-md="80" fxFlex="100" *ngIf="party != null" style="padding: 5px;">

        <div style="margin-bottom: 30px;" [@opacityInOut]>

          <h2>Now playing</h2>

          <mat-card>
            <mat-card-content>
              <div fxLayout="row">
                <div *ngIf="queue != null && queue.nowPlaying != null" fxFlex="100" fxFlex.gt-md="50">
                  <div fxLayout="row" fxLayoutGap="20px">
                    <div class="now-playing-thumbnail"
                         [style.background-image]="getArtistThumbnail(queue.nowPlaying, true)"></div>
                    <mat-list>
                      <mat-list-item>
                        <mat-icon mat-list-icon>music_note</mat-icon>
                        <h4 mat-line> {{ queue.nowPlaying.title }}</h4>
                        <p mat-line> {{ queue.nowPlaying.artist }}</p>
                      </mat-list-item>
                      <mat-list-item>
                        <mat-icon mat-list-icon>person</mat-icon>
                        <h4 mat-line>Requested by {{ queue.nowPlaying.member.displayName }}</h4>
                      </mat-list-item>
                      <mat-list-item>
                        <mat-icon mat-list-icon>av_timer</mat-icon>
                        <div mat-line>
                          <mat-progress-bar
                            color="primary"
                            mode="determinate"
                            [value]="progress">
                          </mat-progress-bar>
                        </div>
                      </mat-list-item>
                    </mat-list>
                  </div>
                  <div *ngIf="queue == null || queue.nowPlaying == null">
                    <div fxLayout="column" fxLayoutAlign="center center">
                      <h3>Nothing is currently playing</h3>
                    </div>
                  </div>
                </div>

                <div *ngIf="queue != null && queue.entries.length > 0" fxHide="true" fxShow.gt-md="true"
                     fxFlex.gt-md="50">
                  <div fxLayout="row" fxLayoutGap="20px" fxLayoutAlign="end">
                    <div>
                      <h3>Up next</h3>
                      <mat-list>
                        <mat-list-item *ngFor="let entry of queue.entries | slice:0:2">
                          <mat-icon class="artist-thumbnail" mat-list-icon
                                    [style.background-image]="getArtistThumbnail(entry, true)"></mat-icon>
                          <h4 mat-line> {{ entry.title }}</h4>
                          <p mat-line> {{entry.artist }}</p>
                        </mat-list-item>
                      </mat-list>
                    </div>
                  </div>
                </div>

              </div>

            </mat-card-content>
          </mat-card>
        </div>

        <div [@opacityInOut]>

          <mat-card>
            <mat-card-content>

              <mat-tab-group>
                <mat-tab label="Queue">
                  <div *ngIf="queue != null">

                    <div fxLayout="column" fxLayoutAlign="center center" *ngIf="queue.entries.length == 0">
                      <h3>The queue is empty</h3>
                      <h4>Start by selecting a song using the search field above</h4>
                    </div>

                    <table class="full-width" *ngIf="queue.entries.length > 0">
                      <thead>
                      <tr>
                        <th class="column-header">Song</th>
                        <th class="column-header">Artist</th>
                        <th class="column-header">Requested by</th>
                        <th></th>
                      </tr>
                      </thead>
                      <tbody>
                      <tr *ngFor="let entry of queue.entries">
                        <td>
                          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
                            <mat-icon mat-list-icon class="artist-thumbnail"
                                      [style.background-image]="getArtistThumbnail(entry, true)"></mat-icon>
                            <span>{{ entry.title }}</span>
                          </div>
                        </td>
                        <td>{{entry.artist }}</td>
                        <td>{{ entry.member.displayName }}</td>
                        <td>
                          <div fxLayout="row" fxLayoutGap="10px">
                            <button mat-icon-button color="primary" (click)="vote(entry, true)">
                              <mat-icon>thumb_up</mat-icon>
                              <span style="position: relative; top: 2px; left: 4px">{{entry.upvotes}}</span>
                            </button>

                            <button mat-icon-button color="danger" (click)="vote(entry, false)">
                              <mat-icon>thumb_down</mat-icon>
                              <span style="position: relative; top: 2px; left: 4px">{{entry.downvotes}}</span>
                            </button>
                          </div>
                        </td>
                      </tr>
                      </tbody>
                    </table>
                  </div>
                </mat-tab>

                <mat-tab label="History">
                  <div *ngIf="history != null">

                    <div fxLayout="column" fxLayoutAlign="center center" *ngIf="history.items.length == 0">
                      <h3>No history available</h3>
                    </div>

                    <table class="full-width" *ngIf="history.items.length > 0">
                      <thead>
                      <tr>
                        <th class="column-header">Song</th>
                        <th class="column-header">Artist</th>
                        <th class="column-header">Requested by</th>
                        <th></th>
                      </tr>
                      </thead>
                      <tbody>
                      <tr *ngFor="let entry of history.items">
                        <td>
                          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
                            <mat-icon mat-list-icon class="artist-thumbnail"
                                      [style.background-image]="getArtistThumbnail(entry, true)"></mat-icon>
                            <span>{{ entry.title }}</span>
                          </div>
                        </td>
                        <td>{{entry.artist }}</td>
                        <td>{{ entry.member.displayName }}</td>
                        <td>
                          <div fxLayout="row" fxLayoutGap="10px">
                            <button mat-icon-button color="primary" disabled>
                              <mat-icon>thumb_up</mat-icon>
                              <span style="position: relative; top: 2px; left: 4px">{{entry.upvotes}}</span>
                            </button>

                            <button mat-icon-button color="danger" disabled>
                              <mat-icon>thumb_down</mat-icon>
                              <span style="position: relative; top: 2px; left: 4px">{{entry.downvotes}}</span>
                            </button>
                          </div>
                        </td>
                      </tr>
                      </tbody>
                    </table>
                  </div>
                </mat-tab>
              </mat-tab-group>
            </mat-card-content>
          </mat-card>
        </div>
      </div>


      <div fxFlex.gt-md="20" fxFlex="100" *ngIf="party != null" style="padding: 5px;" [@opacityInOut]>
        <h2>Chat</h2>

        <mat-card style="height: 62vh; padding: 2px;">
          <mat-card-content class="chat-container">
            <div style="overflow-y: scroll;  height: 100%;" #chatContainer [scrollTop]="chatContainer.scrollHeight">
              <div style="padding: 10px; min-height: 18px;" *ngFor="let message of messages">
                <span style="font-size: 13px;">{{ message.timestamp | date: 'hh:mm:ss' }}</span>
                <span style="font-size: 13px; font-weight: bold;" [style.color]="getMessageColor(message)">{{message.sender}}</span>
                <span
                  style="font-size: 13px; white-space:normal; word-wrap:break-word;">: {{message.message | emojify}}</span>
              </div>
            </div>
            <div class="send-chat-btn">
              <input mdInput class="chat-input" (keydown)="sendChatMessage($event)" #chatInput
                     placeholder="Type to chat">
              <button mat-raised-button color="accent" [disabled]="!websocketAuthenticated"
                      (click)="sendChatMessage()">
                Send
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

    </div>

  </div>

</app-sidebar-layout>
